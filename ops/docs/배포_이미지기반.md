# 이미지 기반 배포 가이드

## 📦 사전 빌드된 도커 이미지로 배포하기

### 1. 필수 사전 요구사항
- **Docker** 설치 (v20.10 이상)
- **NVIDIA Container Toolkit** (GPU 가속 사용 시)
- 10GB 이상의 저장 공간

### 2. 이미지 다운로드
```bash
# 백엔드 이미지 다운로드
docker pull ghcr.io/chatbot-with-kt-dgucenter/chatbot-with-kt-dgucenter-backend:latest

# 프론트엔드 이미지 다운로드
docker pull ghcr.io/chatbot-with-kt-dgucenter/chatbot-with-kt-dgucenter-frontend:latest
```

### 3. 백엔드 컨테이너 실행 (GPU 지원)
```bash
docker run -d --gpus all \
  -p 8000:8000 \
  -e NVIDIA_VISIBLE_DEVICES=all \
  -e SERVICE_KEY=your_service_key \
  -e NAVER_CLIENT_ID=your_naver_id \
  -e NAVER_CLIENT_SECRET=your_naver_secret \
  --name dsl-chat-bot-backend \
  ghcr.io/chatbot-with-kt-dgucenter/chatbot-with-kt-dgucenter-backend:latest
```

### 4. 프론트엔드 컨테이너 실행
```bash
docker run -d \
  -p 3000:3000 \
  -e REACT_APP_API_URL=http://<백엔드_IP>:8000 \
  --name dsl-chat-bot-frontend \
  ghcr.io/chatbot-with-kt-dgucenter/chatbot-with-kt-dgucenter-frontend:latest
```

> **참고**: `<백엔드_IP>`는 백엔드 서버의 실제 IP 주소로 변경

### 5. 환경변수 설정 가이드
| 변수 이름 | 설명 | 필수 | 기본값 |
|-----------|------|------|--------|
| `NVIDIA_VISIBLE_DEVICES` | 사용할 GPU 장치 | GPU 사용 시 | `all` |
| `SERVICE_KEY` | 백엔드 인증 키 | ✅ | - |
| `NAVER_CLIENT_ID` | 네이버 API 클라이언트 ID | ✅ | - |
| `NAVER_CLIENT_SECRET` | 네이버 API 클라이언트 시크릿 | ✅ | - |
| `REACT_APP_API_URL` | 프론트엔드에서 사용할 API 주소 | ✅ | `http://localhost:8000` |

### 6. 네트워크 구성 예시 (도커 네트워크 사용)
```bash
# 사용자 정의 네트워크 생성
docker network create dsl-network

# 백엔드 컨테이너 (네트워크에 연결)
docker run -d --network dsl-network \
  --name dsl-backend \
  -e SERVICE_KEY=your_key \
  ghcr.io/...-backend:latest

# 프론트엔드 컨테이너 (네트워크에 연결)
docker run -d --network dsl-network \
  -p 3000:3000 \
  -e REACT_APP_API_URL=http://dsl-backend:8000 \
  --name dsl-frontend \
  ghcr.io/...-frontend:latest
```

### 7. 로그 확인 및 모니터링
```bash
# 백엔드 로그 확인
docker logs -f dsl-chat-bot-backend

# 프론트엔드 로그 확인
docker logs -f dsl-chat-bot-frontend

# GPU 사용량 모니터링
docker exec dsl-chat-bot-backend nvidia-smi
```

### 8. 서비스 중지 및 제거
```bash
# 컨테이너 중지
docker stop dsl-chat-bot-backend dsl-chat-bot-frontend

# 컨테이너 제거
docker rm dsl-chat-bot-backend dsl-chat-bot-frontend

# 이미지 제거
docker rmi ghcr.io/chatbot-with-kt-dgucenter/chatbot-with-kt-dgucenter-backend:latest
docker rmi ghcr.io/chatbot-with-kt-dgucenter/chatbot-with-kt-dgucenter-frontend:latest
```

### 9. 자주 묻는 질문 (FAQ)

**Q: 이미지를 최신 버전으로 업데이트하려면?**  
```bash
docker pull ghcr.io/chatbot-with-kt-dgucenter/chatbot-with-kt-dgucenter-backend:latest
docker stop dsl-chat-bot-backend
docker rm dsl-chat-bot-backend
docker run ... # 새 컨테이너 실행
```

**Q: GPU를 사용하지 않고 실행하려면? - 권장 X**  

`--gpus all` 옵션 제거 후 실행:
```bash
docker run -d -p 8000:8000 ... \
  ghcr.io/...-backend:latest
```

**Q: 환경변수를 파일로 관리하려면?**  
`.env` 파일 생성 후:
```bash
docker run -d --env-file .env ... \
  ghcr.io/...-backend:latest
```

---